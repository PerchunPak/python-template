# Contributing

This file is describing our code style and some other documentation about contributions. You must read it before your
first contribution.

Also note that this all is just recommendations, you can use anything in some cases, if it will be better than solution
that we propose here. However, we will prefer these recommendations when we will review your contribution.

## `make test`

This "magic" command collects almost all of our CI. If you're on Windows, try [Chocolatey](https://chocolatey.org) to
run `make`.

Also, because of conflict between `pytest-testmon` and `pytest-cov` we use option `--no-cov` in `pytest`, so in this
way we give prioritize to `pytest-testmon`. If you want to generate a report with `pytest-cov`, use `make test ci=1`.

## Code Style

We use `black` for almost all style control. We're also trying to use formatters instead of linters, where it is
possible.

Furthermore, we also have some rules that `black` doesn't cover. It includes:

### Imports

We have `isort` and `pycln` for imports control. The first used for sorting imports, and second, to remove unused
imports. All other rules are not covered by linters/formatters etc. You should check those yourself.

You should use `import ... as ...` whenever it's possible, but sometimes `from ... import ...` style more useful.
For example:

```py
from dataclasses import dataclass
```

If you're using only one variable from module, you should use `from ... import ...`. But if you're using many variables
from module, better would be `import ... as ...`:

```py
# bad
from typing import Union, Optional, TypedDict, TypeAlias, TYPE_CHECKING, Dict, List  # etc
# good
import typing
```

But wait, where there is `as` actually? You must not use `as` when alias will be the same as actual name because in that
way type checker add import statement to auto-generated `__all__` variable.

You should also don't use `as` when everything that changes are dots replaced by `_`. This is just useless.

```py
# bad
import some.more as some_more
# good
import some.more
```

And finally, when you should use `as`:

```py
import sqlalchemy.ext.asyncio as sqlalchemy_asyncio
import my_project.config as config
import my_project.models as models
```

Also, you must specify `__all__` variable in all `__init__.py` files with any code (not one docstring). Reason of this
limitation is that `pycln` and docs can't know exactly, do you want to add imports as alias, or this import is for using
in code which in this file. `pycln` will ignore these imports, and docs will duplicate documentation for anything that you
will import.

### Docstrings

We're using `flake8` for checking docstrings presence and their quality. They later in API documentation. You must write
docstrings everywhere, except `__init__` methods (not the same as `__init__.py` files) because those will not go to
documentation.

I also recommend reading [Google styleguide about docstrings](https://google.github.io/styleguide/pyguide.html#s3.8-comments-and-docstrings)
because we're using Google style in docstrings.

#### Markup

Because of Sphinx's limitations, we must use ReST markup in docstrings. This allows us to use cross-references to other
functions or even projects.

Read more about [ReST markup](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html)
and [Sphinx's cross-references](https://docs.readthedocs.io/en/stable/guides/cross-referencing-with-sphinx.html).

#### `__init__.py` docstrings

They describe a package (folder) with modules (`.py` files).

#### Module, function, class, method based docstrings

It is a short description of an item. They must follow
[Google styleguide about docstrings](https://google.github.io/styleguide/pyguide.html#s3.8-comments-and-docstrings).

#### Variable-based docstrings 

They must follow in format:

```py
some_variable = "abc"
"""This ``some`` variable used in :class:`.SomeClass`."""
```

This applies for the module level, and class attributes in
[dataclasses](https://docs.python.org/3/library/dataclasses.html)/classes generated by [attrs](https://pypi.org/project/attrs/).
This won't work in `__init__` methods because they don't actually go to documentation. Attributes should be documented
in class-based docstring, in `Attributes` section.

At now, linter doesn't detect them. Better sometimes check that all in API documentation actually documented.

## Translations

If you don't know languages which we support - left translation on us.

To update `.po` files run `make translate`, after that, you can edit translations in `.po` files, which can be found as
`locales/<language's tag>/LC_MESSAGES/messages.po`. After editing, for compilation, you can run one more time
`make translate`.

To add new language, use `pybabel init -i locales/base.pot -l <language's tag> -d locales`.

P.S. Language's tag it is short name of this language, example `en` or `en_EN`. A full list of supported languages can
be found with `pybabel --list-locales`.

## Documentation

We use Sphinx for documentation and [docstrings](#Docstrings) for API documentation. At now, there is no actual styles
here, except `doc8`.

## Other Help

You can contribute by spreading a word about this library. It would also be a huge contribution to write a short article
on how you are using this project. You can also share your best practices with us.
